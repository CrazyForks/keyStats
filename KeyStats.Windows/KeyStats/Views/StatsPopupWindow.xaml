<Window x:Class="KeyStats.Views.StatsPopupWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:KeyStats.Views.Controls"
        xmlns:viewmodels="clr-namespace:KeyStats.ViewModels"
        Title="æŒ‰é”®ç»Ÿè®¡"
        Width="360"
        SizeToContent="Height"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ShowInTaskbar="False"
        Topmost="True"
        ResizeMode="NoResize"
        Deactivated="Window_Deactivated"
        Opacity="0">
    <Window.RenderTransform>
        <TranslateTransform x:Name="WindowTransform"/>
    </Window.RenderTransform>

    <Window.DataContext>
        <viewmodels:StatsPopupViewModel/>
    </Window.DataContext>

    <Border Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}"
            BorderBrush="{DynamicResource {x:Static SystemColors.ActiveBorderBrushKey}}"
            BorderThickness="1"
            CornerRadius="8">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="2" Opacity="0.3"/>
        </Border.Effect>

        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Stats Section -->
            <StackPanel Grid.Row="0">
                <!-- Key Presses -->
                <controls:StatItemControl Icon="âŒ¨ï¸" Title="æŒ‰é”®æ¬¡æ•°" Value="{Binding KeyPresses}" Margin="0,0,0,8"/>

                <!-- Click Row -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <controls:StatItemControl Grid.Column="0" Icon="ðŸ–±ï¸" Title="å·¦é”®ç‚¹å‡»" Value="{Binding LeftClicks}" Margin="0,0,8,0"/>
                    <controls:StatItemControl Grid.Column="1" Icon="ðŸ–±ï¸" Title="å³é”®ç‚¹å‡»" Value="{Binding RightClicks}" Margin="8,0,0,0"/>
                </Grid>

                <!-- Distance Row -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <controls:StatItemControl Grid.Column="0" Icon="â†”ï¸" Title="é¼ æ ‡ç§»åŠ¨" Value="{Binding MouseDistance}" Margin="0,0,8,0"/>
                    <controls:StatItemControl Grid.Column="1" Icon="â†•ï¸" Title="æ»šè½®æ»šåŠ¨" Value="{Binding ScrollDistance}" Margin="8,0,0,0"/>
                </Grid>
            </StackPanel>

            <!-- Key Breakdown Section -->
            <StackPanel Grid.Row="1">
                <TextBlock Text="æŒ‰é”®åˆ†å¸ƒ" Style="{StaticResource SectionTitle}"/>
                <controls:KeyBreakdownControl
                    Column1Items="{Binding Column1Items}"
                    Column2Items="{Binding Column2Items}"
                    Column3Items="{Binding Column3Items}"/>
            </StackPanel>

            <!-- History Section -->
            <StackPanel Grid.Row="2">
                <TextBlock Text="åŽ†å²è®°å½•" Style="{StaticResource SectionTitle}"/>

                <!-- Range Selection -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <RadioButton Grid.Column="0" Content="æœ€è¿‘7å¤©" GroupName="Range"
                                 IsChecked="{Binding SelectedRangeIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=0}"/>
                    <RadioButton Grid.Column="1" Content="æœ€è¿‘30å¤©" GroupName="Range"
                                 IsChecked="{Binding SelectedRangeIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=1}"/>
                </Grid>

                <!-- Metric Selection -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <RadioButton Grid.Column="0" Content="ç‚¹å‡»" GroupName="Metric" FontSize="11"
                                 IsChecked="{Binding SelectedMetricIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=0}"/>
                    <RadioButton Grid.Column="1" Content="æŒ‰é”®" GroupName="Metric" FontSize="11"
                                 IsChecked="{Binding SelectedMetricIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=1}"/>
                    <RadioButton Grid.Column="2" Content="ç§»åŠ¨" GroupName="Metric" FontSize="11"
                                 IsChecked="{Binding SelectedMetricIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=2}"/>
                    <RadioButton Grid.Column="3" Content="æ»šåŠ¨" GroupName="Metric" FontSize="11"
                                 IsChecked="{Binding SelectedMetricIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=3}"/>
                </Grid>

                <!-- Chart Style Selection -->
                <Grid Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <RadioButton Grid.Column="0" Content="æŠ˜çº¿å›¾" GroupName="ChartStyle"
                                 IsChecked="{Binding SelectedChartStyleIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=0}"/>
                    <RadioButton Grid.Column="1" Content="æŸ±çŠ¶å›¾" GroupName="ChartStyle"
                                 IsChecked="{Binding SelectedChartStyleIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=1}"/>
                </Grid>
            </StackPanel>

            <!-- Chart -->
            <controls:StatsChartControl Grid.Row="3"
                                        ChartData="{Binding ChartData}"
                                        ChartStyle="{Binding SelectedChartStyleIndex}"
                                        SelectedMetricIndex="{Binding SelectedMetricIndex}"
                                        Margin="0,0,0,6"/>

            <!-- Summary -->
            <TextBlock Grid.Row="4" Text="{Binding HistorySummary}"
                       Style="{StaticResource SecondaryText}" Margin="0,0,0,0"/>
        </Grid>
    </Border>
</Window>
